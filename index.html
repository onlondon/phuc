<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tr√°i tim h·ª£p th·ªÉ üíñ</title>
<style>
  body {
    margin: 0;
    padding: 0;
    background: radial-gradient(circle at center, #220018, #000);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  canvas {
    border-radius: 20px;
    background: radial-gradient(circle at center, #220018, #000);
    width: 600px;
    height: 600px;
  }
</style>
</head>
<body>
<canvas id="canvas" width="600" height="600"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const W = canvas.width;
const H = canvas.height;

// ===============================
// 1Ô∏è‚É£ V·∫Ω h√¨nh tr√°i tim m·∫´u ƒë·ªÉ l·∫•y ƒëi·ªÉm
// ===============================
const tempCanvas = document.createElement("canvas");
const tctx = tempCanvas.getContext("2d");
const heartSize = 300;
tempCanvas.width = W;
tempCanvas.height = H;
tctx.fillStyle = "#fff";
tctx.beginPath();
for (let t = 0; t < Math.PI * 2; t += 0.01) {
  const x = 16 * Math.pow(Math.sin(t), 3);
  const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
  if (t === 0) tctx.moveTo(W/2 + x*heartSize/16, H/2 - y*heartSize/16);
  else tctx.lineTo(W/2 + x*heartSize/16, H/2 - y*heartSize/16);
}
tctx.closePath();
tctx.fill();

const imageData = tctx.getImageData(0, 0, W, H);
const heartPoints = [];
for (let y = 0; y < H; y += 6) {
  for (let x = 0; x < W; x += 6) {
    const i = (y * W + x) * 4;
    if (imageData.data[i] > 128) {
      heartPoints.push({x, y});
    }
  }
}

// ===============================
// 2Ô∏è‚É£ T·∫°o c√°c h·∫°t tr√°i tim nh·ªè
// ===============================
class Heart {
  constructor() {
    this.reset();
  }

  reset() {
    this.x = Math.random() * W;
    this.y = H + Math.random() * 200;
    this.size = Math.random() * 1.8 + 0.8;
    this.color = `hsl(${Math.random() * 40 + 330}, 100%, ${Math.random() * 20 + 60}%)`;
    this.alpha = 1;
    this.target = heartPoints[Math.floor(Math.random() * heartPoints.length)];
    this.speed = Math.random() * 0.03 + 0.02;
    this.angle = Math.random() * Math.PI * 2;
  }

  update() {
    const dx = this.target.x - this.x;
    const dy = this.target.y - this.y;
    this.x += dx * this.speed;
    this.y += dy * this.speed;

    // Rung nh·∫π quanh v·ªã tr√≠ m·ª•c ti√™u
    this.angle += 0.05;
    this.x += Math.sin(this.angle) * 0.3;
    this.y += Math.cos(this.angle) * 0.3;
  }

  draw() {
    ctx.save();
    ctx.globalAlpha = this.alpha;
    ctx.fillStyle = this.color;
    const s = this.size;
    ctx.beginPath();
    ctx.moveTo(this.x, this.y);
    ctx.bezierCurveTo(this.x - s, this.y - s, this.x - s*2, this.y + s/2, this.x, this.y + s*1.5);
    ctx.bezierCurveTo(this.x + s*2, this.y + s/2, this.x + s, this.y - s, this.x, this.y);
    ctx.fill();
    ctx.restore();
  }
}

const hearts = [];
for (let i = 0; i < 4000; i++) {
  hearts.push(new Heart());
}

// ·∫¢nh ·ªü gi·ªØa tr√°i tim
const centerImage = new Image();
centerImage.src = "g.jpg"; // ‚Üê ƒë·ªïi n·∫øu t√™n kh√°c
let imageOpacity = 0;            // ban ƒë·∫ßu ·∫£nh ·∫©n
const appearDelay = 5000;        // th·ªùi gian ch·ªù (ms)
let startTime = null;

function animate(timestamp) {
  if (!startTime) startTime = timestamp;
  const elapsed = timestamp - startTime;

  ctx.clearRect(0, 0, W, H);

  // C·∫≠p nh·∫≠t & v·∫Ω c√°c h·∫°t tr√°i tim
  for (let h of hearts) {
    h.update();
    h.draw();
  }

  // Sau 5s m·ªõi b·∫Øt ƒë·∫ßu hi·ªán ·∫£nh d·∫ßn l√™n
  if (elapsed > appearDelay && centerImage.complete && centerImage.naturalWidth > 0) {
    const fadeDuration = 2000; // th·ªùi gian ·∫£nh fade-in (ms)
    imageOpacity = Math.min(1, (elapsed - appearDelay) / fadeDuration);

    const imgSize = 180;
    ctx.save();
    ctx.globalAlpha = imageOpacity;
    ctx.beginPath();
    ctx.arc(W / 2, H / 2, imgSize / 2, 0, Math.PI * 2);
    ctx.clip();
    ctx.drawImage(centerImage, W / 2 - imgSize / 2, H / 2 - imgSize / 2, imgSize, imgSize);
    ctx.restore();
  }

  requestAnimationFrame(animate);
}

// Ch·∫°y animation sau khi ·∫£nh t·∫£i xong
centerImage.onload = () => {
  requestAnimationFrame(animate);
};


animate();

</script>
</body>
</html>
